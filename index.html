<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Merger</title>
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    <link rel="stylesheet" href="/public/index.css">
</head>
<body>
    <nav class="menubar">
        <div class="menubar-brand">
            <svg class="menubar-logo" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="-300 0 900 500">
                <path fill="currentColor" fill-rule="nonzero" d="M59.904 0H277.45a9.13 9.13 0 017.303 3.641l110.781 119.851a9.069 9.069 0 012.419 6.179H398v322.613c0 16.401-6.783 31.384-17.651 42.253-10.87 10.87-25.855 17.651-42.255 17.651H59.904c-16.421 0-31.422-6.756-42.294-17.628C6.763 483.714 0 468.75 0 452.284V59.906C0 43.422 6.739 28.44 17.59 17.59 28.44 6.739 43.42 0 59.904 0zM18.289 339.085h361.422V147.794c-30.513 0-71.711 4.559-96.489-16.605-12.663-10.821-19.766-26.266-21.174-45.471a9.129 9.129 0 01-.086-1.254V18.289H59.904c-11.435 0-21.839 4.686-29.384 12.231-7.545 7.544-12.231 17.949-12.231 29.386v279.179zm361.422 18.495H18.289v94.704c0 11.413 4.705 21.802 12.251 29.347 7.566 7.566 17.984 12.268 29.364 12.268h278.19c11.355 0 21.757-4.723 29.325-12.292 7.569-7.569 12.292-17.969 12.292-29.323V357.58zm-68.556-109.127H287.47v32.322h-27.864v-87.076h57.121l-3.483 22.292H287.47v11.703h23.685v20.759zM166.61 280.775v-87.076h39.008c15.698 0 26.472 3.345 32.322 10.033 5.853 6.686 8.78 17.854 8.78 33.505 0 15.651-2.927 26.819-8.78 33.507-5.85 6.688-16.624 10.031-32.322 10.031H166.61zm39.427-64.784h-11.564v42.493h11.564c3.809 0 6.571-.44 8.289-1.323 1.718-.882 2.579-2.903 2.579-6.06v-27.725c0-3.158-.861-5.178-2.579-6.061-1.718-.882-4.48-1.324-8.289-1.324zm-78.785 43.747h-18.111v21.037H81.277v-87.076h43.886c19.969 0 29.952 10.728 29.952 32.184 0 11.796-2.6 20.526-7.801 26.192-1.949 2.136-4.644 3.949-8.08 5.433-3.436 1.488-7.431 2.23-11.982 2.23zm-18.111-43.747v21.456h6.409c3.343 0 5.782-.348 7.314-1.045 1.533-.697 2.299-2.298 2.299-4.806v-9.753c0-2.507-.766-4.111-2.299-4.806-1.532-.697-3.971-1.046-7.314-1.046h-6.409zm11.322 219.91c-5.207 0-9.43-4.224-9.43-9.431 0-5.207 4.223-9.431 9.43-9.431H273.73c5.207 0 9.431 4.224 9.431 9.431 0 5.207-4.224 9.431-9.431 9.431H120.463zM280.25 25.577v58.847c1.041 14.194 6.017 25.376 14.832 32.907 19.07 16.285 57.587 12.174 81.231 12.174L280.25 25.577z"/>
            </svg>
            <h2>PDF Merger</h2>
        </div>
        <div class="menubar-actions">
            <button class="theme-toggle" id="theme-toggle">Switch Theme</button>
        </div>
    </nav>
    
    <aside class="sidebar">
        <nav class="sidebar-nav">
            <ul>
                <li>
                    <a href="#" class="active" title="Merge PDFs">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M8 5H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-1M8 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M8 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2m0 0h2a2 2 0 0 1 2 2v3m2 4H10m0 0l3-3m-3 3l3 3"/>
                        </svg>
                    </a>
                </li>
                <li>
                    <a href="#" title="Compress PDF">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M6 3h12a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3z"></path>
                            <line x1="7" y1="7" x2="17" y2="7"></line>
                            <line x1="7" y1="10" x2="17" y2="10"></line>
                            <line x1="7" y1="13" x2="17" y2="13"></line>
                            <line x1="7" y1="16" x2="17" y2="16"></line>
                            <path d="M2 9c1 0 1.5-1 1.5-2s.5-2 1.5-2"></path>
                            <path d="M22 9c-1 0-1.5-1-1.5-2s-.5-2-1.5-2"></path>
                            <path d="M2 15c1 0 1.5 1 1.5 2s.5 2 1.5 2"></path>
                            <path d="M22 15c-1 0-1.5 1-1.5 2s-.5 2-1.5 2"></path>
                        </svg>
                    </a>
                </li>
                <li>
                    <a href="#" title="Remove Pages">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M6 4h8a4 4 0 0 1 4 4v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"></path>
                            <line x1="14" y1="10" x2="10" y2="14"></line>
                            <line x1="10" y1="10" x2="14" y2="14"></line>
                        </svg>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>
    
    <div class="hero">
        <h1>PDF Merger</h1>
        <p>Easily combine multiple PDF files into a single document with our powerful PDF merger tool. Drag and drop your files below to get started.</p>
    </div>
    <div class="container">
        <div class="app-container">
            <div class="drag-area" id="drag-area">
                <p>Drag & Drop PDF Files Here</p>
                <label for="file-input">Choose PDF Files</label>
                <input type="file" id="file-input" multiple accept="application/pdf">
            </div>

            <ul class="file-list" id="file-list"></ul>

            <button class="merge-button" id="merge-button" disabled>Merge & Download PDF</button>
        </div>
    </div>

    <script>
        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
        
        // Set initial theme based on user's system preference
        if (prefersDarkScheme.matches) {
            document.body.dataset.theme = 'dark';
            themeToggle.textContent = '☀️ Light Mode';
        } else {
            document.body.dataset.theme = 'light';
            themeToggle.textContent = '🌙 Dark Mode';
        }

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.body.dataset.theme;
            if (currentTheme === 'dark') {
                document.body.dataset.theme = 'light';
                themeToggle.textContent = '🌙 Dark Mode';
            } else {
                document.body.dataset.theme = 'dark';
                themeToggle.textContent = '☀️ Light Mode';
            }
        });

        const dragArea = document.getElementById('drag-area');
        const fileInput = document.getElementById('file-input');
        const fileList = document.getElementById('file-list');
        const mergeButton = document.getElementById('merge-button');

        let files = [];

        // Prevent default drag behaviors
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            document.body.addEventListener(eventName, preventDefaults, false);
            dragArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults (e) {
            e.preventDefault();
            e.stopPropagation();
        }

        // Add visual feedback
        ['dragenter', 'dragover'].forEach(eventName => {
            document.body.addEventListener(eventName, highlight, false);
            dragArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            document.body.addEventListener(eventName, unhighlight, false);
            dragArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            dragArea.style.background = getComputedStyle(document.documentElement).getPropertyValue('--bg-hover');
            dragArea.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-color');
        }

        function unhighlight() {
            dragArea.style.background = getComputedStyle(document.documentElement).getPropertyValue('--bg-secondary');
            dragArea.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--border-color');
        }

        // Handle drops
        document.body.addEventListener('drop', handleDrop, false);
        dragArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(selectedFiles) {
            for (const file of selectedFiles) {
                if (file.type === 'application/pdf') {
                    files.push(file);
                }
            }
            updateFileList();
        }

        function updateFileList() {
            fileList.innerHTML = '';
            files.forEach((file, index) => {
                const li = document.createElement('li');
                li.innerHTML = `<span>${file.name}</span> <button onclick="removeFile(${index})">Remove</button>`;
                fileList.appendChild(li);
            });
            mergeButton.disabled = files.length === 0;
        }

        function removeFile(index) {
            files.splice(index, 1);
            updateFileList();
        }

        mergeButton.addEventListener('click', async () => {
            try {
                // Create a new PDF document
                const mergedPdf = await PDFLib.PDFDocument.create();
                
                // Process each PDF file
                for (const file of files) {
                    // Convert File object to ArrayBuffer
                    const arrayBuffer = await file.arrayBuffer();
                    // Load the PDF document
                    const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
                    // Get all pages
                    const pages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                    // Add each page to the new document
                    pages.forEach(page => mergedPdf.addPage(page));
                }
                
                // Save the merged PDF
                const mergedPdfFile = await mergedPdf.save();
                
                // Create download link
                const downloadUrl = URL.createObjectURL(new Blob([mergedPdfFile], { type: 'application/pdf' }));
                const downloadLink = document.createElement('a');
                downloadLink.href = downloadUrl;
                downloadLink.download = 'merged.pdf';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                URL.revokeObjectURL(downloadUrl);
            } catch (error) {
                console.error('Error merging PDFs:', error);
                alert('An error occurred while merging the PDFs. Please try again.');
            }
        });
    </script>
</body>
</html>
